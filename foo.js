var P=function(){function b(){}return b.I=function(a,d,h,e,c,b,g,l){var f=a.getContext("webgl2"),k;for(k in f)f[k[0]+k[6]]=f[k];f.f1=f.uniform1f;f.f2=f.uniform2f;f.mm=f.generateMipmap;f.i1=f.uniform1i;var n=Object.keys(b||{}),m=f.cP();a=f.cS(35633);f.sS(a,d);f.ce(a);f.aS(m,a);a=f.cS(35632);f.sS(a,h);f.ce(a);f.aS(m,a);f.lo(m);f.ug(m);f.bf(34962,f.cB());f.eV(0);f.vA(0,2,5120,0,0,0);f.bD(34962,new Int8Array([-3,1,1,-3,1,1]),35044);n.forEach(function(a){var c=new Image;c.onload=function(){f.bx(3553,f.cT());
    f.tg(3553,0,6408,512,512,0,6408,5121,c);f.mm(3553)};c.src=b[a].d});var r=performance.now()/1E3,q=function(){var a=r-performance.now()/1E3;f.f1(f.gf(m,"time"),a);f.f2(f.gf(m,"resolution"),e,c);l&&Object.keys(l).forEach(function(c){l[c](f.gf(m,c),f,m,a)});n.forEach(function(a,c){f.aT(33984+c);f.i1(f.gf(m,a),c)});f.dr(6,0,3);requestAnimationFrame(q)};q();g&&g(f,m)},b}(),Synth=function(){function b(){}return b.G=function(a,d,h,e){var c=document.createElement("canvas").getContext("webgl2");for(g in c)c[g[0]+
    g[6]]=c[g];c.f1=c.uniform1f;c.f2=c.uniform2f;var b=c.cP();var g=c.cS(35633);c.sS(g,this.vs);c.ce(g);c.aS(b,g);g=c.cS(35632);if(c.sS(g,a),c.ce(g),c.aS(b,g),!c.getShaderParameter(g,c.COMPILE_STATUS))throw c.getShaderInfoLog(g).trim().split("\n").forEach(function(a){return console.warn("[shader] "+a)}),Error("Error while compiling fragment");return c.vr(0,0,h,e),c.lo(b),c.ug(b),c.bf(34962,c.createBuffer()),c.eV(0),c.vA(0,2,5120,0,0,0),c.bD(34962,new Int8Array([-3,1,1,-3,1,1]),35044),c.f1(c.gf(b,"sampleRate"),
    d),c.f2(c.gf(b,"resolution"),h,e),function(a,f,g){g=g||new Uint8Array(h*e*4);return c.f1(c.gf(b,"bufferTime"),a/d),c.f1(c.gf(b,"channel"),f),c.dr(6,0,3),c.rx(0,0,h,e,6408,5121,g),g}},b.P=function(a){var d=[],h=0,e=0,c=new AudioContext,b=c.createGain(),g=c.createDynamicsCompressor(),l=c.createGain();l.gain.value=.6;b.connect(g);g.connect(l);l.connect(c.destination);var f=function(h,e){var f=c.createBufferSource();f.connect(b);var g=a(h,0),k=c.createBuffer(2,g.length,c.sampleRate);return k.getChannelData(0).set(g),
    a(h,1,g),k.getChannelData(1).set(g),f.buffer=k,f.start(e),d.push({data:g,width:128,height:64,bufferTime:h,destroy:function(){f.disconnect(b)}}),{b:h+g.length,t:e+k.duration}},p=function(){var a=f(h,e);h=a.b;e=a.t};!function m(){d=d.filter(function(a){return!(a.bufferTime+a.data.length<Math.floor(c.currentTime*c.sampleRate)&&(a.destroy(),1))});a&&c.currentTime+8>e&&p();setTimeout(m,100)}()},b.vs="#version 300 es\n  #ifdef GL_ES\n    precision highp float;\n    precision highp int;\n    precision mediump sampler3D;\n  #endif\n  layout(location = 0) in vec2 pos; \n  out vec4 fragColor;\n      void main() { gl_Position = vec4(2.0*pos-1.0, 0.0, 1.0);\n  }",
    b}(),__extends=this&&this.__extends||function(){var b=function(a,d){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c])})(a,d)};return function(a,d){function h(){this.constructor=a}b(a,d);a.prototype=null===d?Object.create(d):(h.prototype=d.prototype,new h)}}(),TextureBase=function(){function b(){this.perm=this.seed(255)}return b.prototype.normalize=function(a){var d=this.length(a);return 0!=d?
    this.func(a,function(a,b){return a/d}):a},b.prototype.fract=function(a){return a%1},b.prototype.abs=function(a){return a.map(function(a,b){return Math.abs(a)})},b.prototype.func=function(a,d){return a.map(function(a,b){return d(a,b)})},b.prototype.toScale=function(a,d){return(a-0)/(d-0)*2+-1},b.prototype.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]},b.prototype.length=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},b.prototype.fade=function(a){return a*a*a*(a*(6*a-15)+10)},
    b.prototype.lerp=function(a,d,b){return d+a*(b-d)},b.prototype.grad=function(a,d,b,e){a&=15;var c=8>a?d:b;d=4>a?b:12==a||14==a?d:e;return(0==(1&a)?c:-c)+(0==(2&a)?d:-d)},b.prototype.scale=function(a){return(1+a)/2},b.prototype.seed=function(a){for(var d=[],b=[],e=0;a>=e;e++)b.push(e);for(e=0;a>=e;e++){var c=a*Math.random(),k=b[~~c];b.splice(c,1,b[e]);b.splice(e,1,k)}for(e=0;e<a;e++)d[a+e]=d[e]=b[e];return d},b.prototype.noise=function(a,d,b){var e=this.perm,c=255&~~a,h=255&~~d,g=255&~~b;a-=~~a;d-=
    ~~d;b-=~~b;var l=this.fade(a),f=this.fade(d),p=this.fade(b),n=e[c]+h,m=e[n]+g;n=e[n+1]+g;h=e[c+1]+h;c=e[h]+g;g=e[h+1]+g;return this.scale(this.lerp(p,this.lerp(f,this.lerp(l,this.grad(e[m],a,d,b),this.grad(e[c],a-1,d,b)),this.lerp(l,this.grad(e[n],a,d-1,b),this.grad(e[g],a-1,d-1,b))),this.lerp(f,this.lerp(l,this.grad(e[m+1],a,d,b-1),this.grad(e[c+1],a-1,d,b-1)),this.lerp(l,this.grad(e[n+1],a,d-1,b-1),this.grad(e[g+1],a-1,d-1,b-1)))))},b}(),Texture=function(){function b(a,b){var d=this;this.width=
    a;this.height=b;this.coord=function(a,b,e,h,f,p){return p.apply(d.helpers,[[a[0],a[2],a[1]],b,e,h,f])};var e=document.createElement("canvas");e.width=a;e.height=b;this.ctx=e.getContext("2d");this.ctx.fillStyle="#000000";this.ctx.fillRect(0,0,this.width,this.height);this.buffer=this.ctx.getImageData(0,0,this.width,this.height);this.helpers=new TextureBase}return b.createTexture=function(a,d,h){a=new b(a,d);return a.render(h),a.toBase64()},b.prototype.render=function(a){for(var b=this.buffer,h=this.width,
    e=this.height,c,k=0;k<h;k++)for(var g=0;g<e;g++){c=4*(k+g*h);var l=this.coord([b.data[c+0],b.data[c+1],b.data[c+2]],k,g,h,e,a);b.data[c+0]=l[0];b.data[c+1]=l[1];b.data[c+2]=l[2]}this.ctx.putImageData(b,0,0)},b.prototype.toBase64=function(){return this.ctx.canvas.toDataURL("image/png")},b}(),TextureCanvas=function(b){function a(a,h){return b.call(this,a,h)||this}return __extends(a,b),a.prototype.draw=function(a){return a.apply(this.helpers,[this.ctx,this.width,this,this.height])},a.createTexture=function(b,
    h,e){b=new a(b,h);return b.draw(e),b.toBase64()},a}(Texture),dsp="#version 300 es\n#ifdef GL_ES\n  precision highp int;\n  precision highp float;\n#endif\nuniform float sampleRate;\nuniform vec2 resolution;\nuniform float channel;\nuniform float bufferTime;\nout vec4 fragColor;\n\nfloat PI = 3.14;\nfloat tau = 6.28;\n\nfloat sub(float wave, float mul, float t){\n  return sin(wave * mul + tau * t);\n}\n\nfloat sine(float x, float t){\n  return sin(tau * t * x);\n}\n\nfloat tri(float x, float t){\n  return abs(1.0 - mod((2.0 * t * x), 2.0)) * 2.0 - 1.0;\n}\n\n\nfloat dsp(float t){\n  float n = 44000.0 / 341.5;\n\n  float bass_osc =\n    0.8 * tri(n/3.0, t)\n  + 0.05 * sine(n*2.0, t)\n  ;\n\n  float lfo = sine(0.18, t);\n  float lfo_mul = sine(0.04, t);\n  float bass_sub =\n    0.8 * sub(bass_osc, 2.0 + ((1.0 + lfo) * (2.0 + (1.0 + lfo_mul) * 12.0) ), t)\n  + 0.7 * sine(n, t)\n  ;\n\n  return 0.4 * bass_sub;\n}\n\nvoid main(){\n \tfloat t = bufferTime + 4.*(gl_FragCoord.y * resolution.x + gl_FragCoord.x) / sampleRate;\n\tvec4 r = vec4(dsp(t),dsp(t+1.0/sampleRate), dsp(t+2.0/sampleRate), dsp(t+3.0/sampleRate)); \n\tfragColor = (r+1.0)/2.0;\n}",
    generator=Synth.G(dsp,44100,128,64),kaliset=Texture.createTexture(512,512,function(b,a,d,h,e){var c=this,k=Math;b=.18*function(a){for(var b=0,d=b,e=0;13>e;e++){var g=d;d=c.length(a);var h=c.dot(a,a);a=c.func(a,function(a,b){return k.abs(a)/h-.5});b+=k.exp(-1/k.abs(d-g))}return b}([c.toScale(a,h),c.toScale(d,h),0]);return[Math.abs(280.5*b),Math.abs(b*b*331.5),Math.abs(b*b*b*255)]});
    P.I(document.querySelector("#webgl"),"#version 300 es\n    #ifdef GL_ES\n        precision highp float;\n        precision highp int;\n        precision mediump sampler3D;\n    #endif\n    layout(location = 0) in vec2 pos; \n    out vec4 fragColor;\n    void main() { \n        gl_Position = vec4(pos.xy,0.0,1.0);\n    }","#version 300 es\n    #ifdef GL_ES\n        precision highp float;\n        precision highp int;\n        precision mediump sampler3D;\n    #endif\n    uniform float time;\n    uniform vec2 mouse;\n    uniform vec2 resolution;\n    uniform sampler2D iChannel0,iChannel1,iChannel2,iChannel3,iChannel4,fft;out vec4 fragColor;\n    #define RAY_STEPS 100\n    #define SHADOW_STEPS 50\n    #define LIGHT_COLOR vec3(1.,.97,.93)\n    #define AMBIENT_COLOR vec3(.75,.65,.6)\n    #define SPECULAR 0.65\n    #define DIFFUSE 1.0\n    #define AMBIENT 0.35\n    #define BRIGHTNESS 1.5\n    #define GAMMA 1.35\n    #define SATURATION.8\n    #define detail.00004\n    #define t time*.2\n    vec3 v=normalize(vec3(.1,-.15,-1.));const vec3 m=vec3(-1.,.2,0.);float f=0.;vec3 r;mat2 s(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}vec4 n(vec4 v){return v.rb=abs(v.rb+1.)-abs(v.rb-1.)-v.rb,v=v*2./clamp(dot(v.rgb,v.rgb),.15,1.)-vec4(.5,.5,.8,0.),v.rg*=s(.5),v;}float x(vec3 v){float m=length(v.gb-vec2(.25,0.))-.5,i=length(v.gb-vec2(.25,2.))-.5;return min(max(m,abs(v.r-.3)-.01),max(i,abs(v.r+2.3)-.01));}vec2 i(vec3 v){float i=0.;vec3 f=v;f.b=abs(2.-mod(f.b,4.));vec4 m=vec4(f,1.5);float b=max(0.,.35-abs(v.g-3.35))/.35;\n    #ifdef LESSDETAIL\n    for(int r=0;r<6;r++)m=n(m);float r=max(-f.r-4.,(length(max(vec2(0.),m.gb-2.))-.5)/m.a);\n    #else\n    for(int c=0;c<8;c++)m=n(m);float c=max(-f.r-4.,length(max(vec2(0.),m.gb-3.))/m.a);\n    #endif\n    float s=x(f),d=min(s,c);if(abs(d-s)<.001)i=1.;return vec2(d,i);}vec2 p(vec3 v){v.b=abs(2.-mod(v.b,4.));float m,i=m=0.,f=1000.;for(int r=0;r<15;r++){v=n(vec4(v,0.)).rgb;float s=i;i=length(v);m+=exp(-10./abs(i-s));f=min(f,abs(i-3.));}return vec2(m,f);}vec3 d(float v){vec3 r=vec3(sin(v)*2.,(1.-sin(v*.5))*.5,-cos(v*.25)*30.)*.5;return r;}vec3 w(vec3 v){vec3 m=vec3(0.,f,0.);return normalize(vec3(i(v+m.grr).r-i(v-m.grr).r,i(v+m.rgr).r-i(v-m.rgr).r,i(v+m.rrg).r-i(v-m.rrg).r));}float d(vec3 v,vec3 r){float m=1.,c=2.*f,s=10.;for(int b=0;b<SHADOW_STEPS;b++){if(c<1.&&s>detail){vec3 d=v-c*r;s=i(d).r;m=min(m,max(50.*s/c,0.));c+=max(.01,s);}}return clamp(m,.1,1.);}float i(const vec3 v,const vec3 m){float r=detail*40.,f=0.,c=13.;for(int b=0;b<5;b++){float s=r*float(b*b);vec3 d=m*s+v;float n=i(d).r;f+=-(n-s)*c;c*=.7;}return clamp(1.-5.*f,0.,1.);}vec3 d(in vec3 m,in vec3 f,in vec3 s,in float r){float b=d(m,v),c=i(m,s),e=max(0.,dot(v,-s))*b*DIFFUSE;vec3 n=max(.5,dot(f,-s))*AMBIENT*AMBIENT_COLOR,a=reflect(v,s);float S=pow(max(0.,dot(f,-a))*b,15.)*SPECULAR;vec3 g;vec2 l=p(m);if(r>.5)g=vec3(1.),S=S*S;else{float A=pow(l.r*.11,2.);g=mix(vec3(A,A*A,A*A),vec3(A),.5)+.1;g+=pow(max(0.,1.-l.g),5.)*.3;}g=g*c*(n+e*LIGHT_COLOR)+S*LIGHT_COLOR;if(r>.5){vec3 A=m;A.b=abs(1.-mod(A.b,2.));vec3 R=texture(iChannel4,mod(1.-m.bg-vec2(.4,.2),vec2(1.))).rgb*2.;g+=R*abs(.01-mod(m.g-time*.1,.02))/.01*c;g*=max(0.,1.-pow(length(A.gb-vec2(.25,1.)),2.)*3.5);}else{vec3 A=texture(iChannel4,mod(m.br*2.+vec2(.5),vec2(1.))).rgb;A*=abs(.01-mod(m.r-time*.1*sign(m.r+1.),.02))/.01;g+=pow(l.r,10.)*3e-10*A;g+=pow(max(0.,1.-l.g),4.)*pow(max(0.,1.-abs(1.-mod(m.b+time*2.,4.))),2.)*vec3(1.,.8,.4)*4.*max(0.,.05-abs(m.r+1.))/.05;}return g;}vec3 n(in vec3 m,in vec3 s){float r,c,b=r=0.;vec2 a=vec2(1.,0.);vec3 A,g=vec3(0.);for(int n=0;n<RAY_STEPS;n++){if(a.r>f&&b<30.){A=m+b*s;a=i(A);f=detail*(1.+b*50.);b+=a.r;if(a.r<.015)r+=max(0.,.015-a.r)*exp(-b);}}float n=max(0.,dot(normalize(-s),normalize(v)));vec3 S=vec3(max(0.,-s.g+.6))*AMBIENT_COLOR*.5*max(.4,n);if(a.r<f||b<30.){A=A-abs(a.r-f)*s;vec3 l=w(A);g=d(A,s,l,a.g);g=mix(g,S,1.-exp(-.15*pow(b,1.5)));}else{g=S;vec3 l=(s*3.+vec3(1.3,2.5,1.25))*.3;for(int e=0;e<13;e++)l=abs(l)/dot(l,l)-.9;g+=min(1.,pow(min(5.,length(l)),3.)*.0025);}vec3 l=LIGHT_COLOR*pow(n,25.)*.5;g+=r*(.5+n*.5)*LIGHT_COLOR*.7;g+=l*exp(min(30.,b)*.02);return g;}vec3 e(inout vec3 v){vec3 m=d(t),r=d(t+.7);float b=i(r).r;vec3 a=normalize(r-m);float f=r.r-m.r;f*=min(1.,abs(r.b-m.b))*sign(r.b-m.b)*.7;v.rg*=mat2(cos(f),sin(f),-sin(f),cos(f));f=a.g*1.7;v.gb*=mat2(cos(f),sin(f),-sin(f),cos(f));f=atan(a.r,a.b);v.rb*=mat2(cos(f),sin(f),-sin(f),cos(f));return m;}void main(){r=d(t+.3)+m;vec2 v=gl_FragCoord.rg/resolution.rg*2.-1.;v.g*=resolution.g/resolution.r;vec3 f=normalize(vec3(v*.8,1.)),i=m+e(f),b=n(i,f);b=clamp(b,vec3(0.),vec3(1.));b=pow(b,vec3(GAMMA))*BRIGHTNESS;b=mix(vec3(length(b)),b,SATURATION);fragColor=vec4(b,1.);}\n    ",
    innerWidth,innerHeight,{iChannel0:{d:kaliset}},function(b,a){document.querySelector("#webgl").addEventListener("click",function(){Synth.P(generator)})});